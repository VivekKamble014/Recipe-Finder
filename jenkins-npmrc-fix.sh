#!/bin/bash

echo "ğŸ”§ Recipe Finder - Jenkins NPMRC Fix"
echo "===================================="

echo "âœ… Fixed Jenkinsfile to handle custom npm registry!"
echo ""
echo "ğŸ¯ The issue was:"
echo "   âŒ npm trying to connect to local Nexus at localhost:8081"
echo "   âŒ Nexus service not running in Jenkins environment"
echo "   âŒ ECONNREFUSED error when trying to fetch eslint"
echo ""
echo "ğŸ”§ The solution:"
echo "   âœ… Temporarily backup .npmrc during Jenkins build"
echo "   âœ… Use default npm registry (npmjs.com) for dependencies"
echo "   âœ… Restore .npmrc after build completes"
echo ""
echo "ğŸ“ Next steps:"
echo "1. Go to Jenkins: http://localhost:8080"
echo "2. Open your job: recipe-finder-deployment"
echo "3. Click 'Build Now'"
echo "4. Monitor the build progress"
echo ""
echo "ğŸš€ The pipeline will now:"
echo "   âœ… Install Node.js using nvm"
echo "   âœ… Backup .npmrc to avoid Nexus connection issues"
echo "   âœ… Install dependencies from default npm registry"
echo "   âœ… Run ESLint using npx"
echo "   âœ… Build React app using npx"
echo "   âœ… Deploy using npm serve on port 3000"
echo "   âœ… Restore .npmrc after build"
echo ""
echo "ğŸ” After successful build:"
echo "   - Application: http://localhost:3000"
echo "   - Logs: /tmp/recipe-finder.log"
echo ""
echo "ğŸ‰ This should now work without Nexus connection errors!"
echo ""
echo "ğŸ’¡ Key fix: Temporarily disable custom registry during build"
echo "   to avoid connection issues with local Nexus service."
